<?xml version="1.0" encoding="UTF-8"?>
<document
  xmlns="http://maven.apache.org/XDOC/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/XDOC/2.0 http://maven.apache.org/xsd/xdoc-2.0.xsd">

  <properties>
    <title>gtyrell</title>
  </properties>

  <body>
    <subsection name="gytrell">
      <var>gtyrell</var> is a tiny server that periodically synchronizes a set of
      <a href="http://git-scm.com">Git</a> repositories.
    </subsection>
    <subsection name="Requirements">
      <ul class="requirements">
        <li><a href="http://git-scm.com">Git</a></li>
        <li>A JRE supporting Java 7 or greater.</li>
      </ul>
    </subsection>
    <subsection name="Building">
      <pre>$ mvn clean package</pre>
    </subsection>
    <subsection name="Running">
      <p>
        Compilation produces a jar file containing all of the dependencies.
      </p>
      <pre>
$ java -jar io7m-gtyrell-server/target/io7m-gtyrell-server-${project.version}-main.jar
usage: server.conf [logback.xml]
      </pre>
      <p>
        The program accepts a configuration file and an optional
        <a href="http://logback.qos.ch">Logback</a> configuration file to control
        logging. The default is to log everything.
      </p>
      <p>
        The <var>gtyrell</var> configuration file is in
        <a href="https://en.wikipedia.org/wiki/.properties">Java Properties</a>
        format:
      </p>
      <pre>
# The base directory to which repository directories will be written
com.io7m.gtyrell.server.directory       = /git/com.github

# The path to the Git executable
com.io7m.gtyrell.server.git_executable  = /usr/bin/git

# The time to pause between synchronization attempts
com.io7m.gtyrell.server.pause_duration  = 0h 15m 0s

# A list of repository sources
com.io7m.gtyrell.server.repository_sources = github0

# A GitHub repository source
com.io7m.gtyrell.server.repository_source.github0.type     = github
com.io7m.gtyrell.server.repository_source.github0.user     = someone
com.io7m.gtyrell.server.repository_source.github0.password = enoemos123
      </pre>
      <p>
        The above configuration will cause the server to authenticate to
        the <a href="https://developer.github.com/v3/">GitHub API</a> as
        <var>someone</var> using the password <var>enoemos123</var>, and
        retrieve a list of all of the repositories owned by the user. For
        each repository <var>r</var>, it will then clone <var>r</var>
        to <var>/git/com.github/someone/r.git</var> if it has not yet been
        cloned, or fetch updates to <var>r</var> if it has. When all updates
        have been performed, it will pause for 15 minutes before trying again.
      </p>
      <p>
        Currently, only GitHub is supported as a repository source, and only
        in the authenticated per-user manner specified.
      </p>
    </subsection>
  </body>

</document>
